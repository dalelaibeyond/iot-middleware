# V6800 Device Message Reference

Quick reference for V6800 IoT gateway message formats and topics.

## Message Types & Topics

| Type | Topic Pattern | msg_type |
|------|---------------|------------|
| Heartbeat | `V6800Upload/{device_id}/OpeAck` | `heart_beat_req` |
| RFID | `V6800Upload/{device_id}/LabelState` | `u_state_changed_notify_req` |
| Temperature & Humidity | `V6800Upload/{device_id}/TemHum` | `temper_humidity_exception_nofity_req` |
| Noise | `V6800Upload/{device_id}/Noise` | `noise_exception_nofity_req` |
| Door | `V6800Upload/{device_id}/OpeAck` | `door_state_changed_notify_req` |
| Device & Module Info | `V6800Upload/{device_id}/OpeAck` | `devies_init_req` |

## Message Formats

### Heartbeat
```json
{
  "msg_type": "heart_beat_req",
  "module_type": "mt_gw",
  "module_sn": "gateway_sn",
  "bus_V": "voltage",
  "bus_I": "current",
  "main_power": 0/1,
  "backup_power": 0/1,
  "uuid_number": id,
  "data": [
    { "module_index": port, "module_sn": "sn", "module_m_num": m, "module_u_num": u }
  ]
}
```

### RFID
```json
{
  "msg_type": "u_state_changed_notify_req",
  "gateway_sn": "gateway_sn",
  "uuid_number": id,
  "data": [
    {
      "host_gateway_port_index": port,
      "extend_module_sn": "sn",
      "u_data": [
        { "u_index": pos, "new_state": 0/1, "old_state": 0/1, "tag_code": "hex", "warning": 0/1 }
      ]
    }
  ]
}
```

### Temperature & Humidity
```json
{
  "msg_type": "temper_humidity_exception_nofity_req",
  "gateway_sn": "gateway_sn",
  "uuid_number": id,
  "data": [
    {
      "host_gateway_port_index": port,
      "extend_module_sn": "sn",
      "th_data": [
        { "temper_position": pos, "hygrometer_position": pos, "temper_swot": temp, "hygrometer_swot": hum }
      ]
    }
  ]
}
```

### Noise
```json
{
  "msg_type": "noise_exception_nofity_req",
  "gateway_sn": "gateway_sn",
  "uuid_number": id,
  "data": [
    {
      "host_gateway_port_index": port,
      "extend_module_sn": "sn",
      "noise_data": [
        { "noise_position": pos, "noise_swot": level }
      ]
    }
  ]
}
```

### Door
```json
{
  "msg_type": "door_state_changed_notify_req",
  "gateway_sn": "gateway_sn",
  "uuid_number": id,
  "data": [
    { "extend_module_sn": "sn", "host_gateway_port_index": port, "new_state": 0/1 }
  ]
}
```

### Device & Module Info
```json
{
  "msg_type": "devies_init_req",
  "gateway_sn": "gateway_sn",
  "gateway_ip": "ip",
  "gateway_mac": "mac",
  "uuid_number": id,
  "data": [
    {
      "module_type": "type",
      "module_index": port,
      "module_sn": "sn",
      "module_m_num": m,
      "module_u_num": u,
      "module_sw_version": "ver",
      "module_supplier": "supplier",
      "module_brand": "brand",
      "module_model": "model"
    }
  ]
}
```

## Common JSON Structure
```json
{
  "deviceId": "<gateway_sn>",
  "deviceType": "V6800",
  "msgType": "<type>",
  "sensorType": "<sensor_type>",
  "modAdd": null,
  "modPort": <port>,
  "modId": "<module_sn>",
  "ts": "<timestamp>",
  "payload": {...},
  "meta": {
    "rawTopic": "<original_topic>",
    "msgId": "<uuid_number>"
  }
}
```

## Notes
- All raw messages are JSON objects (not hex strings like V5008)
- Multiple ports in data array should create separate normalized messages
- Temperature/humidity: 6 sensors per module (positions 10-15)
- Noise: 3 sensors per module (positions 16-18)
- RFID action: 0=detached, 1=attached
- Door state: 0=closed, 1=open